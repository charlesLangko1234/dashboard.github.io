<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../style/basicReading.css">
    <link rel="stylesheet" href="../style/detail.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@600&family=Poppins:ital,wght@1,600&display=swap" rel="stylesheet">
    <title>Hello, world!</title>
  </head>
  <body>
    <div class="container-fluid" style="background-color: #353334;">
      <div class="row">
        <!-- Start Side Navbar -->
        <div class="col-sm-auto sticky-top vh-100" style="background-color: #13213C;">
          <div class="d-flex flex-sm-column flex-row flex-nowrap align-items-center sticky-top" style="background-color: #13213C;">
              <ul class="nav nav-pills nav-flush flex-sm-column flex-row flex-nowrap mb-auto mx-auto text-center justify-content-between w-100 px-3 align-items-center">
                <li class="nav-item">
                  <a href="./home.html" class="nav-link py-3 px-2" title="Home" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="BasicReading">
                      <i class='bx bx-home' style="font-size: 30px; color: #FFFFFF;"></i>
                  </a>
                </li>
                <li class="nav-item">
                    <a href="./basicReading.html" class="nav-link py-3 px-2" title="Basic Reading" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="BasicReading">
                        <i class='bx bxs-tachometer' style="color: #FFFFFF;"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./powerQuality.html" class="nav-link py-3 px-2" title="Power Quality" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="PowerQuality">
                        <i class='bx bxs-car-battery' style="color: #FFFFFF;"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./report.html" class="nav-link py-3 px-2" title="Report" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Report">
                        <i class='bx bx-alarm-exclamation' style="color: #FFFFFF;"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./detail.html" class="nav-link py-3 px-2 active" title="Detail" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Detail">
                        <i class='bx bxs-file-doc' style="color: #FFFFFF;"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./settings.html" class="nav-link py-3 px-2" title="Setting" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Setting">
                        <i class='bx bx-cog' style="color: #FFFFFF;"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="../index.html" class="nav-link py-3 px-2 mt-5" title="Logout" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Power">
                        <i class='bx bx-power-off' style="color: #FFFFFF;"></i>
                    </a>
                </li>
              </ul>
          </div>
        </div>
        <!-- End Side Navbar -->

       <!-- Start Device -->
       <div class="col ms-2 vh-100 col-3 d-flex flex-column justify-content-start align-items-center" style="background-color: #E5E5E5;">
        <form class="d-flex mt-3" id="searchForm">
            <input class="form-control me-2" id="searchInput" type="search" placeholder="Search" aria-label="Search">
            <button class="btn" id="serachButton" type="submit" style="background-color: #FCA311; color: white;">Search</button>
        </form>

        <div class="group mt-2" style="overflow-y: scroll; scrollbar-width: auto;">
          <div class="card mt-3 text-center" style="color: white; background-color: #13213C;">
            <div class="card-body machine-card" data-machine-name="Machine 1" style="width: 22rem;">
              <h5 class="card-title">Machine 1</h5>
              <p class="card-text">Indonesia, Tangerang</p>
              <p class="card-text">PM5350</p>
              <a href="#" class="btn" style="background-color: #FCA311; color: white;">Detail</a>
            </div>
        </div>

        <div class="card mt-3 text-center" style="background-color: #13213C; color: white;">
            <div class="card-body machine-card" data-machine-name="Machine 2" style="width: 22rem;">
              <h5 class="card-title">Machine 2</h5>
              <p class="card-text">Indonesia, Bandung</p>
              <p class="card-text">PM730</p>
              <a href="#" class="btn" style="background-color: #FCA311; color: white;">Detail</a>
            </div>
        </div>

        <div class="card mt-3 text-center" style="background-color: #13213C; color: white;">
            <div class="card-body machine-card" data-machine-name="Machine 3" style="width: 22rem;">
              <h5 class="card-title">Machine 3</h5>
              <p class="card-text">Indonesia, Surabaya</p>
              <p class="card-text">PM710</p>
              <a href="#" class="btn" style="background-color: #FCA311; color: white;">Detail</a>
            </div>
        </div>
        
        <div class="card mt-3 text-center" style="background-color: #13213C; color: white;">
            <div class="card-body machine-card" data-machine-name="Machine 4" style="width: 22rem;">
              <h5 class="card-title">Machine 4</h5>
              <p class="card-text">Indonesia, Makassar</p>
              <p class="card-text">PM510</p>
              <a href="#" class="btn" style="background-color: #FCA311; color: white;">Detail</a>
            </div>
        </div>

        <div class="card mt-3 text-center" style="background-color: #13213C; color: white;">
            <div class="card-body machine-card" data-machine-name="Machine 5" style="width: 22rem;">
              <h5 class="card-title">Machine 5</h5>
              <p class="card-text">Indonesia, Bogor</p>
              <p class="card-text">PM310</p>
              <a href="#" class="btn" style="background-color: #FCA311; color: white;">Detail</a>
            </div>
        </div>
        </div>
      </div>
      <!-- End Device -->

          <div class="col ms-2 me-2 vh-100" style="color: white; background-color: #E5E5E5; overflow-y: hidden;">
            <div class="row m-2 d-flex flex-column">
                <select class="form-select addData" aria-label="Default select example">
                    <option disabled selected>Add Data</option>
                    <option value="1">Total Active Energy</option>
                    <option value="2">Total Reactive Energy</option>
                    <option value="3">Total Apparent Energy</option>
                    <option value="4">Total Active Power</option>
                    <option value="5">Total Reactive Power</option>
                    <option value="6">Total Apparent Power</option>
                    <option value="7">Total Voltage LL</option>
                    <option value="8">Total Voltage LN</option>
                    <option value="9">Total Current</option>
                </select>
            </div>
            <div class="row m-2 d-flex flex-column">
                <select class="form-select subtractData" aria-label="Default select example">
                    <option disabled selected>Subtract Data</option>
                    <option value="1">Total Active Energy</option>
                    <option value="2">Total Reactive Energy</option>
                    <option value="3">Total Apparent Energy</option>
                    <option value="4">Total Active Power</option>
                    <option value="5">Total Reactive Power</option>
                    <option value="6">Total Apparent Power</option>
                    <option value="7">Total Voltage LL</option>
                    <option value="8">Total Voltage LN</option>
                    <option value="9">Total Current</option>
                </select>
            </div>
            <div class="row m-2 d-flex justify-content-center">
                <div class="col-8 m-3 p-2" style="border: 3px solid black; border-radius: 20px; background-color: #E5E5E5;">
                  <h2 class="d-flex justify-content-center" id="timestampHeader" style="font-family: 'Poppins', sans-serif; color: black;">Graphic Data - Macine 1</h2>
                  <canvas id="energyChart" ></canvas>
                </div>                
            </div>
            
              
            <div class="row m-2 group" style="border: 1px solid black; height: 80vh; overflow-y: scroll; font-size: 15px; scrollbar-width: auto;">
              <table class="table dataTable" style="color: black;">
                <thead>
                  <tr>
                    <th scope="col">TimeStamp</th>
                    <th scope="col">Parameter</th>
                    <th scope="col">Present</th>
                  </tr>
                </thead>
                <tbody id="dataTableBody">
                  <!-- Table body will be populated dynamically -->
                </tbody>
              </table>
            </div>
            
          </div>
        </div>
    </div>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../logic/detail.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const buttons = document.querySelectorAll('.btn');
    
        buttons.forEach(function (button) {
          button.addEventListener('click', function (event) {
            event.preventDefault();
    
            // Extract the machine name from the card title
            const machineName = this.parentNode.querySelector('.card-title').textContent;
            updateTimestampHeader(machineName);
    
            // Reset the table data
            resetTable();
            resetDropdowns();
            
            // Update the table with new data
            updateTable();
          });
        });
      });
    
      function updateTimestampHeader(machineName) {
        const timestampHeader = document.getElementById('timestampHeader');
        timestampHeader.textContent = `Graphic Data - ${machineName}`;
      }
    
      function resetTable() {
        resetChart();
        const tableBody = document.getElementById('dataTableBody');
        tableBody.innerHTML = ''; // Clear existing rows
      }
    
      function getRandomTimestamp() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
      }
    
      function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      }
    
      function appendRow(parameter, presentValue) {
        const tableBody = document.getElementById('dataTableBody');
        const timestamp = getRandomTimestamp();
    
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${timestamp}</td>
          <td>${parameter}</td>
          <td>${presentValue}</td>
        `;
    
        tableBody.appendChild(row);
      }
    
      function updateTable() {
        const parameters = [
          'Total active energy (kWh)', 
          'Total reactive energy (kVarh)',
          'Total apparent energy (kVah)'
        ];
    
        parameters.forEach(parameter => {
          const presentValue = numberWithCommas(Math.floor(Math.random() * 10000000) + 1);
          appendRow(parameter, presentValue);
        });
      }

      
      function resetChart() {
        // Clear existing datasets
        datasets.length = 0;

        // Update the chart data and redraw
        myChart.data = {
          labels: ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli'],
          datasets: datasets
        };

        // Update the chart options (if needed)
        myChart.options = options;

        // Update the chart
        myChart.update();
      }

      function resetDropdowns() {
        // Reset the "Add Data" dropdown
        const addDataDropdown = document.querySelector('.addData');
        addDataDropdown.selectedIndex = 0; // Set it to the first option (disabled)

        // Reset the "Subtract Data" dropdown
        const subtractDataDropdown = document.querySelector('.subtractData');
        subtractDataDropdown.selectedIndex = 0; // Set it to the first option (disabled)
      }
    
      setInterval(updateTable, 5000);
      updateTable();

      document.addEventListener('DOMContentLoaded', function () {
          document.getElementById('serachButton').addEventListener('click', function (event) {
            event.preventDefault();

            // Get input value when form is submitted
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            console.log(searchValue);

            // Hide all machine cards
            const machineCards = document.querySelectorAll('.machine-card');
            machineCards.forEach(function (card) {
              card.style.display = 'none';
            });

            // Show only the machine cards that match the search query
            machineCards.forEach(function (card) {
              const realName = card.getAttribute('data-machine-name');
              const cardMachineName = card.getAttribute('data-machine-name').toLowerCase();
              if (cardMachineName.includes(searchValue)) {
                card.style.display = 'block';
              }
            });

            const allCards = document.querySelectorAll('.card');
            allCards.forEach(function (card) {
              const cardMachineName = card.querySelector('.machine-card').getAttribute('data-machine-name').toLowerCase();
              if (!cardMachineName.includes(searchValue)) {
                card.style.display = 'none';
              } else {
                card.style.display = 'block';
              }
            });

          });
        });
    </script>

  </body>
</html>